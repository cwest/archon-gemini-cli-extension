# Implementation Plan: Add Utility Commands and Enhance Specificity

## Overview
This document outlines the implementation plan to address missing requirements identified during a comparative analysis between the requirements specification (`requirements/initial-development.md`) and the initial implementation plan (`PRPs/initial-development.md`). The primary goal is to add the missing utility commands and introduce greater specificity into the build script and command prompts to fully align the project with its foundational requirements.

## Requirements Summary
- **FR-3.2 & FR-3.3: Implement Utility Sub-Commands:** The `/archon:kb` and `/archon:project` commands must be expanded to include their required sub-commands as defined in the requirements specification.
- **FR-1.3: Enhance RAG Tool Specificity:** The `/archon:create-plan` command's prompt must be updated to instruct the model to use the full suite of specified RAG tools for in-depth research.
- **FR-9.4: Enhance Build Script Transformations:** The `build.py` script must be updated to perform the specific string transformations required to make the source command files compatible with the Gemini CLI.
- **FR-5.2: Enhance Validation Phase Specificity:** The `/archon:execute-plan` command's prompt must be updated to explicitly instruct the model to adopt the `validator` persona and generate unit tests for the implemented code.

## Implementation Tasks

### Phase 1: Enhance Build Script and Core Command Prompts
1. **Update `build.py` Transformation Logic**
   - Description: Modify the command transformation logic in `src/build.py` to perform the specific string replacements outlined in FR-9.4. This includes converting `$ARGUMENTS` to `{{args}}`, `mcp__archon__<tool_name>` to `tools.archon.<tool_name>`, and rephrasing agent instructions.
   - Files to modify: `src/build.py`.
   - Dependencies: None.
   - Estimated effort: 3 hours.

2. **Update `create-plan` Prompt Generation**
   - Description: Modify `build.py` to ensure the prompt generated for `/archon:create-plan` explicitly lists the advanced RAG tools (`rag_get_available_sources`, `rag_list_pages_for_source`, `rag_read_full_page`) as required by FR-1.3.
   - Files to modify: `src/build.py`.
   - Dependencies: Task 1.1.
   - Estimated effort: 1 hour.

3. **Update `execute-plan` Prompt Generation**
   - Description: Modify `build.py` to ensure the prompt generated for `/archon:execute-plan` includes a clear instruction for the model to adopt the `validator` persona and generate unit tests for all new code, as required by FR-5.2.
   - Files to modify: `src/build.py`.
   - Dependencies: Task 1.1.
   - Estimated effort: 1 hour.

### Phase 2: Implement Utility Commands
1. **Create Source Files for Utility Commands**
   - Description: Create the source Markdown files for all missing utility sub-commands within a new `archon_source/archon-example-workflow/.claude/commands/` directory (or similar staging area for the build script). This includes files for `/archon:kb search`, `/archon:kb sources`, `/archon:kb find-docs`, `/archon:project features`, and `/archon:project find`.
   - Files to create: 5 new `.md` files in the source directory.
   - Dependencies: None.
   - Estimated effort: 4 hours.

2. **Update `build.py` to Process New Commands**
   - Description: Extend the file discovery logic in `src/build.py` to find and process the newly created utility command source files, transforming them into the correct `.toml` format in the `commands/archon/` directory.
   - Files to modify: `src/build.py`.
   - Dependencies: Task 2.1.
   - Estimated effort: 2 hours.

### Phase 3: CI/CD and Verification
1. **Update CI Workflow**
   - Description: Update the `ci.yml` workflow to verify that the new `.toml` files for the utility sub-commands are correctly generated by the build script and are committed to the repository.
   - Files to modify: `.github/workflows/ci.yml`.
   - Dependencies: Phase 1, Phase 2.
   - Estimated effort: 1 hour.

2. **Manual Testing**
   - Description: After the build script is updated and the CI pipeline passes, perform manual testing by installing the extension and running each of the new utility commands to ensure they function as expected against a running Archon MCP server.
   - Dependencies: Task 3.1.
   - Estimated effort: 2 hours.

## Success Criteria
- [ ] The `build.py` script is updated to perform all specified string transformations correctly.
- [ ] The generated `create-plan.toml` and `execute-plan.toml` files contain the enhanced, more specific instructions.
- [ ] The `build.py` script successfully discovers and generates `.toml` files for all new utility sub-commands.
- [ ] The CI pipeline passes, confirming that all generated artifacts are correct and up-to-date.
- [ ] All new utility commands (`/archon:kb search`, `/archon:project features`, etc.) are installable and functional in the Gemini CLI.

---
*This plan is ready for execution with `/execute-plan`*
